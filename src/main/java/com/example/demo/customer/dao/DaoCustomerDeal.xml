<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.customer.dao.DaoCustomerDeal">
	<select id="SelectCustomerDeals" resultType="com.example.demo.common.UppercasedMap" parameterType="java.util.Map">
		SELECT b.CUSTOMER_DEAL_ID
		,      b.OPEN_YN
		,      a.WRITER_ID
		,      b.BOSS_DEAL_ID
		,      b.HOPE_BOSS_ID
		,      b.HOPE_DT
		,      b.HOPE_REGION_CD
		,      ( SELECT code.VLD_VAL_NM
		           FROM TB_CODES code
		          WHERE code.CD_KNM = '지역구분코드'
		            AND code.VLD_VAL = b.HOPE_REGION_CD
		       ) AS HOPE_REGION_NM
		,      b.HOPE_PEOPLE_CNT
		,      b.HOPE_OTHER_CN
		,      b.HOPE_THEME_CD1
		,      ( SELECT code.VLD_VAL_NM
                   FROM TB_CODES code
		          WHERE code.CD_KNM = '테마구분코드'
                    AND code.VLD_VAL = b.HOPE_THEME_CD1
		       ) AS HOPE_THEME_NM1
		,      b.HOPE_THEME_CD2
		,      ( SELECT code.VLD_VAL_NM
		           FROM TB_CODES code
		          WHERE code.CD_KNM = '테마구분코드'
		            AND code.VLD_VAL = b.HOPE_THEME_CD2
		       ) AS HOPE_THEME_NM2
		,      b.HOPE_THEME_CD3
		,      ( SELECT code.VLD_VAL_NM
		           FROM TB_CODES code
		          WHERE code.CD_KNM = '테마구분코드'
		            AND code.VLD_VAL = b.HOPE_THEME_CD3
		       ) AS HOPE_THEME_NM3
		,      ( CASE WHEN LENGTH(IFNULL(b.HOPE_DT, '~')) != 8
		              THEN '희망일자를 올바르게 적었는지 확인하십시오'
		              WHEN b.HOPE_PEOPLE_CNT IS NULL
		              THEN '예상인원을 올바르게 적었는지 확인하십시오'
		              WHEN b.BOSS_DEAL_ID IS NULL
		               AND b.HOPE_REGION_CD IS NULL
		              THEN '지역을 선택해주십시오'
		              WHEN b.BOSS_DEAL_ID IS NULL
		               AND b.HOPE_THEME_CD1 IS NULL
		               AND b.HOPE_THEME_CD2 IS NULL
		               AND b.HOPE_THEME_CD3 IS NULL
		              THEN '희망테마를 선택해주십시오'
		         END
		       ) AS NEED_WRITE
		  FROM TB_COURSES a
		     , TB_CUSTOMER_DEALS b
		 WHERE 1=1
		   AND b.COURSE_ID = a.COURSE_ID
		 <if test="CUSTOMER_ID != null">
		   AND a.WRITER_ID = #{CUSTOMER_ID}
		 </if>
		<if test="COURSE_ID != null">
			AND a.COURSE_ID   = #{COURSE_ID}
		</if>
		<if test="CUSTOMER_DEAL_ID != null">
			AND b.CUSTOMER_DEAL_ID = #{CUSTOMER_DEAL_ID}
		</if>
	</select>

	<select id="SelectBossDeals" resultType="com.example.demo.common.UppercasedMap" parameterType="java.util.Map">
		SELECT a.BOSS_ID
		,      a.BOSS_DEAL_ID
		,      a.DEAL_CN
		,      b.BOSS_NM
		,      b.INFO
		  FROM TB_BOSS_DEALS a
		,      TB_BOSS       b
		WHERE 1=1
		<if test="ORG_CUSTOMER_DEAL_ID != null">
		AND    a.ORG_CUSTOMER_DEAL_ID = #{ORG_CUSTOMER_DEAL_ID}
		</if>
		AND    b.BOSS_ID              = a.BOSS_ID
		<if test="BOSS_DEAL_ID != null">
			AND a.BOSS_DEAL_ID = #{BOSS_DEAL_ID}
		</if>
	</select>

	<insert id="InsertCustomerDeal" parameterType="java.util.Map">
		INSERT INTO TB_CUSTOMER_DEALS (
		COURSE_ID
		)
		VALUES (
		#{COURSE_ID}
		)
	</insert>

	<delete id="DeleteCustomerDeal" parameterType="java.util.Map">
		DELETE FROM TB_CUSTOMER_DEALS
		WHERE COURSE_ID        = #{COURSE_ID}
		AND   CUSTOMER_DEAL_ID = #{CUSTOMER_DEAL_ID}
	</delete>

	<update id="UpdateCustomerDeal" parameterType="java.util.Map">
		UPDATE TB_CUSTOMER_DEALS
		SET OPEN_YN           = IFNULL(#{OPEN_YN}           , OPEN_YN           )
		,   BOSS_DEAL_ID      = IFNULL(#{BOSS_DEAL_ID}      , BOSS_DEAL_ID      )
		,   HOPE_BOSS_ID      = IFNULL(#{HOPE_BOSS_ID}      , HOPE_BOSS_ID      )
		,   HOPE_DT           = IFNULL(#{HOPE_DT}           , HOPE_DT           )
		,   HOPE_REGION_CD    = IFNULL(#{HOPE_REGION_CD}    , HOPE_REGION_CD    )
		,   HOPE_PEOPLE_CNT   = IFNULL(#{HOPE_PEOPLE_CNT}   , HOPE_PEOPLE_CNT   )
		,   HOPE_OTHER_CN     = IFNULL(#{HOPE_OTHER_CN}     , HOPE_OTHER_CN     )
		,   HOPE_THEME_CD1    = IFNULL(#{HOPE_THEME_CD1}    , HOPE_THEME_CD1    )
		,   HOPE_THEME_CD2    = IFNULL(#{HOPE_THEME_CD2}    , HOPE_THEME_CD2    )
		,   HOPE_THEME_CD3    = IFNULL(#{HOPE_THEME_CD3}    , HOPE_THEME_CD3    )
		WHERE COURSE_ID        = #{COURSE_ID}
		AND   CUSTOMER_DEAL_ID = #{CUSTOMER_DEAL_ID}
	</update>

	<select id="SelectCourses" resultType="com.example.demo.common.UppercasedMap" parameterType="java.util.Map">
		SELECT a.COURSE_ID
		,      IFNULL(a.COURSE_NM, '새 코스') AS COURSE_NM
		,      a.WRITER_ID
		FROM   TB_COURSES a
		WHERE  1=1
		<if test="WRITER_ID != null">
			AND   a.WRITER_ID = #{WRITER_ID}
		</if>
		<if test="COURSE_ID != null">
			AND   a.COURSE_ID = #{COURSE_ID}
		</if>
		<if test="POPULAR_YN != null">
			AND   a.POPULAR_YN = #{POPULAR_YN}
		</if>
	</select>

	<insert id="InsertCourse" parameterType="java.util.Map">
		INSERT INTO TB_COURSES
		(
			WRITER_ID
		)
		VALUES
		(
		    #{WRITER_ID}
		)
	</insert>

	<update id="UpdateCourse" parameterType="java.util.Map">
		UPDATE TB_COURSES
		   SET COURSE_NM = #{COURSE_NM}
		 WHERE COURSE_ID = #{COURSE_ID}
	</update>

	<delete id="DeleteCourse" parameterType="java.util.Map">
		DELETE FROM TB_COURSES
		WHERE COURSE_ID = #{COURSE_ID}
	</delete>
</mapper>